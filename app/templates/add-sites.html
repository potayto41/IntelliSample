<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Add Sites — Sample Dispenser v3</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Offline / system unavailable banner -->
    <div class="offline-banner">
        <div class="offline-banner-inner">
            ⚠️ System offline — Engine unavailable
        </div>
    </div>

    <header class="app-topbar">
        <div class="app-topbar-inner">
            <a href="/" class="app-topbar-logo">Sample Dispenser v3</a>
            <nav class="app-nav">
                <a href="/" class="app-nav-link">Browse</a>
                <a href="/add-sites" class="app-nav-link app-nav-link-active">Add Sites</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container container--wide">
            <header class="page-header">
                <h1 class="page-title">Add Sites</h1>
                <p class="page-subtitle">
                    Add a single site manually or bulk upload from CSV. All fields are optional except the URL.
                </p>
            </header>

            <!-- Manual add form (UI only — no API wiring) -->
            <section class="section-card card">
                <div class="card-header">
                    <h2>Add site manually</h2>
                    <p class="card-subtitle">
                        Quickly add a single site to your catalog.
                    </p>
                </div>
                <form class="add-form" action="/add-site" method="post" id="add-form">
                    <div class="add-form-grid">
                        <label class="field">
                            <span class="field-label">Website URL *</span>
                            <input type="url" name="website_url" placeholder="https://example.com" required>
                        </label>
                        <label class="field">
                            <span class="field-label">Platform</span>
                            <input type="text" name="platform" placeholder="Webflow, Shopify, WordPress, custom...">
                        </label>
                        <label class="field">
                            <span class="field-label">Industry</span>
                            <input type="text" name="industry" placeholder="SaaS, agency, e‑commerce, education...">
                        </label>
                        <label class="field">
                            <span class="field-label">Tags</span>
                            <input type="text" name="tags" placeholder="hero video, dark mode, pricing table (comma‑separated)">
                        </label>
                    </div>
                    <button type="submit" class="btn-primary">Add site</button>
                    <div id="add-status" style="margin-top: 10px;"></div>
                </form>
            </section>

            <!-- Bulk upload (UI only — no API wiring) -->
            <section class="section-card card">
                <div class="card-header">
                    <h2>Bulk upload (.csv)</h2>
                    <p class="card-subtitle">
                        Upload a CSV file with columns: website_url, platform, industry, tags.
                    </p>
                </div>
                <form class="upload-form" action="/upload-csv" method="post" enctype="multipart/form-data" id="upload-form">
                    <label class="field field--file">
                        <span class="field-label">Choose CSV file</span>
                        <input type="file" name="file" accept=".csv">
                    </label>
                    <button type="submit" class="btn-primary">Upload</button>
                    <div id="upload-status" style="margin-top: 10px;"></div>
                </form>
            </section>
        </div>
    </main>

    <footer class="app-footer">
        <div class="app-footer-inner">
            <div class="app-footer-credit">
                <div><strong>Mahe Muntaser</strong></div>
                <div>IGN: Kiri</div>
                <div class="app-footer-actions">
                    <a class="footer-button footer-button-linkedin" href="https://www.linkedin.com/in/mahe-tests-game/" target="_blank" rel="noopener">LinkedIn</a>
                    <a class="footer-button footer-button-youtube" href="https://www.youtube.com/@Kiriplaysgames" target="_blank" rel="noopener">YouTube</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- System initialization & offline detection -->
    <script>
(function () {
    var offlineBanner = document.querySelector('.offline-banner');
    
    // Offline detection
    function updateOfflineState() {
        var isOnline = navigator.onLine;
        if (offlineBanner) {
            offlineBanner.classList.toggle('active', !isOnline);
        }
    }
    
    // Check on startup
    updateOfflineState();
    
    // Listen for online/offline changes
    window.addEventListener('online', updateOfflineState);
    window.addEventListener('offline', updateOfflineState);
    
    // Periodic health check to backend (optional: improve reliability)
    setInterval(function () {
        if (navigator.onLine) {
            fetch('/').catch(function () {
                if (offlineBanner) offlineBanner.classList.add('active');
            });
        }
    }, 10000);

    // Handle CSV upload form
    var uploadForm = document.getElementById('upload-form');
    var uploadStatus = document.getElementById('upload-status');
    
    if (uploadForm && uploadStatus) {
        uploadForm.addEventListener('submit', function (e) {
            e.preventDefault();
            
            var formData = new FormData(uploadForm);
            var fileInput = uploadForm.querySelector('input[type="file"]');
            
            if (!fileInput.files.length) {
                uploadStatus.innerHTML = '<div style="color: red;">Please select a CSV file.</div>';
                return;
            }
            
            uploadStatus.innerHTML = '<div style="color: blue;">Uploading...</div>';
            
            fetch('/upload-csv', {
                method: 'POST',
                body: formData
            })
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                if (data.status === 'complete') {
                    uploadStatus.innerHTML = '<div style="color: green;">Upload complete! ' + data.success_count + ' sites added successfully. ' + (data.failure_count > 0 ? data.failure_count + ' failed.' : '') + '</div>';
                    if (data.errors && data.errors.length > 0) {
                        uploadStatus.innerHTML += '<details><summary>Errors</summary><ul>' + data.errors.map(function (err) {
                            return '<li>Row ' + err.row + ': ' + err.error + '</li>';
                        }).join('') + '</ul></details>';
                    }
                } else {
                    uploadStatus.innerHTML = '<div style="color: red;">Error: ' + (data.error || 'Unknown error') + '</div>';
                }
            })
            .catch(function (error) {
                uploadStatus.innerHTML = '<div style="color: red;">Upload failed: ' + error.message + '</div>';
            });
        });
    }

    // Handle add site form
    var addForm = document.getElementById('add-form');
    var addStatus = document.getElementById('add-status');
    
    if (addForm && addStatus) {
        addForm.addEventListener('submit', function (e) {
            e.preventDefault();
            
            var formData = new FormData(addForm);
            var urlInput = addForm.querySelector('input[name="website_url"]');
            
            if (!urlInput.value.trim()) {
                addStatus.innerHTML = '<div style="color: red;">Please enter a website URL.</div>';
                return;
            }
            
            addStatus.innerHTML = '<div style="color: blue;">Adding site...</div>';
            
            fetch('/add-site', {
                method: 'POST',
                body: formData
            })
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                if (data.status === 'success') {
                    addStatus.innerHTML = '<div style="color: green;">Site added successfully!</div>';
                    addForm.reset();
                } else {
                    addStatus.innerHTML = '<div style="color: red;">Error: ' + (data.error || 'Unknown error') + '</div>';
                }
            })
            .catch(function (error) {
                addStatus.innerHTML = '<div style="color: red;">Add failed: ' + error.message + '</div>';
            });
        });
    }
})();
    </script>
</body>
</html>
